---
title: "Lecture 1"
format:
    revealjs:
        incremental: true
        slide-number: true
        code-overflow: scroll
        code-copy: true
        chalkboard:
            theme: whiteboard
        mermaid:
            theme: default
execute:
    echo: false
    warning: false
bibliography: references.bib
---

# Interpretable Machine Learning for Finance

## Instructor

William Chiu, FRM

-   Financial Risk Manager (FRM) Certified since 2012
-   Northwestern MLDS Alum (Class of 2013)
-   Senior Credit Risk Analyst at a credit bureau (2013-2014)
-   Head of Statistical Modeling at a bank (2014-2023)
-   VP of Predictive Modeling at an insurance company since 2023

## Model Lifecycle

```{mermaid}
timeline
    Business Context    : Understanding the Business Problem
                        : Converting a Business Problem to a ML Problem
    Data Prep   : Data Dictionary
                : Target & Feature Engineering
                : Data Splitting
                : Exploratory Analysis
    Development     : Choosing the Evaluation Metric
                    : Model Training & Selection
                    : Backtesting
                    : Calibration
    Interpretation  : Feature Importance
                    : Feature Dependence
                    : Explaining Individual Predictions
    Validate, Deploy, Monitor   : Model Risk Management
                                : Optimize Inference Speed
                                : Feature & Target Drift
                                : Model Retirement
```

## Business Context

![](Images/dalle-bank-building.png){.absolute top="0" right="0" width="20%"}

1.  Acquire new clients with a marketing response <br> model (aka prescreen model)

2.  Approve (or reject) loan applications with a credit scorecard model

3.  Explain rejected loan applications with counterfactuals

4.  Estimate lifetime credit losses with a transition matrix model

5.  Detect fraud with a cost-sensitive model

## Data Sets

1.  Borrower data from an Indian Bank and Credit Bureau. The instructor modified the data to include `campaign_id`, `control_group`, and `response_flag`. [@cibil-data].

2.  Loan Performance data from LendingClub. Includes both accepted and rejected loan applications. [@lendingclub-data]

3.  Single-Family Loan Performance data from Fannie Mae. [@fanniemae2024]

4.  Simulated data from the *Fraud Detection Handbook* . [@leborgne2022fraud]


## Model Development Tools{.smaller}

:::::::::::: {layout="[[70,30], [100]]"}

![](Images/autogluon.png)

![](Images/Scikit_learn_logo_small.svg.png)

-   AutoGluon is an open-source AutoML framework designed to automate model training and ensembling.
-   AutoGluon achieves strong performance by using ensembling techniques and a comprehensive library of preset hyperparameters for each base learner.
-   AutoGluon offers data preprocessing like automatic encoding of categorical variables and automatic removal of features with no variance.
-   Scikit-learn provides calibration methods (e.g., Platt scaling, isotonic regression) to improve the reliability of predicted probabilities.

::::::::::::

## Interpretable ML Tools

![](Images/dalle-black-box-cogs.png){.absolute top="0" right="0" width="20%"}

-   Rank features from most to least important
    -   Permutation importance
    -   SHAP importance
    -   Dealing with multicollinear features
-   Describe the dependence between features and predictions
    -   Partial dependence plots (PDP)
    -   Accumulated local effects (ALE) plots
    -   SHAP dependence plots

## (More) Interpretable ML tools

-   Explain individual predictions
    -   SHAP values
    -   Counterfactuals

## Prerequisites

-   Comfort using supervised learning methods:
    -   Generalized Linear Models
    -   Trees with bagging and/or boosting
    -   Cross Validation and Bias-Variance Tradeoff
-   Familiarity with Python and data science libraries (i.e., pandas and scikit-learn)
-   Practice with SQL databases

## Assignments and Grading {.smaller}

1.  Problem Sets (70%)
    -   Weekly conceptual questions and programming exercises based on each week's topics.
    -   Reinforce understanding of weekly material and practical application of concepts.
2.  Kaggle Competition (30%)
    -   Develop a scorecard model for loan underwriting.
    -   Apply modeling techniques in a competitive scenario.
    -   Students will be given a labeled training set and an unlabeled test set.
    -   Students will be asked why the model rejected a loan application.
    -   Grades will depend on model performance in an unlabeled test set and the quality of the explanation.

# Introduction to Retail Banking

## What is a Retail Bank?

-   A retail bank serves individual consumers, households, and small businesses
-   Offers deposit and lending products: checking/savings accounts, certificates of deposit, credit cards, and mortgages
-   Some retail banks also offer brokerage and wealth management services
-   A large bank holding company, like JPMorgan Chase, has both a retail bank (Chase Bank) and a bank that serves large businesses, governments, and institutional investors (JPMorgan).

## Revenue Sources

-   Interest collected from loans (e.g., credit cards, auto loans, personal loans, mortgages)
-   Transaction fees, commissions, and service charges
-   Major contributor to profitability: spread between interest collected from loans and interest paid to depositors

## Expense Sources

-   Employee compensation
-   Interest paid to depositors
-   Provision for loan losses

## How could a Bank fail?

-   Insufficient liquidity (not enough cash to meet obligations)
-   Insufficient capital (not enough equity to absorb losses)
-   High levels of non-performing loans or significant credit losses
-   Sudden loss of depositor confidence leading to a bank run
-   Poor risk management and poor investment decisions

## What is FDIC insurance?

-   Protects depositors by guaranteeing their funds up to a certain limit if a bank fails
-   Aims to maintain public confidence and prevent bank runs
-   Standard insurance amount in the US: \$250,000 per depositor, per insured bank

## How do Banks use machine learning?

-   Improve the effectiveness of marketing campaigns
-   Measure the credit risk of loan applicants
-   Estimate the lifetime credit losses of a loan portfolio
-   Detect fraudulent activities

# Introduction to Credit Bureaus

## US Credit Bureaus

-   The US has three major credit bureaus:
    -   Experian
    -   TransUnion
    -   Equifax
-   Credit bureaus serve three major functions:
    -   Collect and maintain consumer credit information
    -   Provide credit reports to lenders
    -   Generate credit scores

## Credit Score Range: 300 to 850 {.nonincremental}

-   Excellent: 800+
-   Very Good: 740-799
-   Good: 670-739
-   Fair: 580-669
-   Poor: Below 580

## Bureau Data

-   **Borrowers**: Consumer identification, address, birthdate, employment information, and credit scores
-   **Trades**: Lending accounts associated with the borrower; details include creditor name, account type, credit limit, outstanding balance, credit utilization rate, and account status
-   **Trade History**: Monthly payment history for each account including payment status, balance changes, and delinquency information

## (More) Bureau Data

-   **Inquiries**: Records of lenders that requested the borrower's credit report
    -   Hard inquiries: affect credit score
    -   Soft inquiries: do not affect credit score

# Prescreen Campaigns to Acquire New Clients

## Business Problem

-   Identify consumers likely to respond to pre-approved credit offers
-   Target prospects based on bureau attributes including recent inquiries, credit scores, and credit history
-   Maximize campaign response rates while adhering to risk policy, legal, and budget constraints

## Prescreening Compliance Framework{.smaller}

- Fair Credit Reporting Act (FCRA)

    - Verify permissible purpose and consumer opt-out status prior to prescreening
    - Ensure firm offers match the criteria used during prescreening
    - Include clear opt-out notices and instructions in every prescreened offer
    - If declined after prescreening, provide an Adverse Action Notice


- Equal Credit Opportunity Act (ECOA)

    - Prohibits discrimination based on race, color, religion, national origin, sex, marital status, or age
    - Apply consistent underwriting standards to all applicants
    - Maintain documentation to demonstrate non-discriminatory practices and facilitate regulatory reviews


## Business Solution

-   Develop selection criteria for credit bureau prescreening
-   Combine bureau data with internal customer data if available
-   Selection criteria typically includes: credit scores, geographic location, bureau attributes, estimated income, existing relationship data, and prior campaign responses

## Machine Learning Problem

-   Requires historical campaign data, response flags, and relevant borrower attributes
-   Predict which prospects are most likely to accept the offer
-   Develop a model that maximizes AUC and estimate a probability threshold that maximizes the F1 score

## Machine Learning Solution

-   Train a classification model on labeled data to identify strong responders
-   Incorporate performance metrics such as AUC, F1 score, lift chart, and gains chart to gauge effectiveness
-   Score new prospects, select high-scoring individuals for the campaign, and measure the lift and gains chart over a control group

## Citations